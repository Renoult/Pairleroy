:root{--bg:#f5ede0;--bg-secondary:#ebe2d3;--panel:#f0e8db;--panel-dark:#e3d9c9;--text:#2d2a26;--text-secondary:#5a5449;--muted:#7a7165;--accent:#c97a36;--accent-hover:#b0682e;--accent-light:rgba(201,122,54,0.18);--accent-ring:rgba(201,122,54,0.45);--accent-wash:rgba(201,122,54,0.14);--overlay-gray:#6f6a5c;--outline:#9a9080;--border:rgba(140,126,103,0.3);--border-strong:rgba(140,126,103,0.5);--shadow-sm:0 2px 6px rgba(0,0,0,0.08);--shadow-md:0 4px 12px rgba(0,0,0,0.12);--shadow-lg:0 8px 24px rgba(0,0,0,0.16)}*{box-sizing:border-box}html,body{height:100%}body{margin:0;background:radial-gradient(rgba(0,0,0,0.02)1px,transparent 1px)0 0/4px 4px,radial-gradient(rgba(0,0,0,0.015)1px,transparent 1px)2px 2px/5px 5px,linear-gradient(135deg,#f8f0e3,#ede4d5 50%,#f3ebe0);color:var(--text);font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";display:flex;flex-direction:column;min-height:100vh;overflow:hidden}.controls{display:flex;flex-wrap:wrap;gap:14px 18px;align-items:center}.controls .field{display:flex;flex-direction:column;gap:8px}.controls .row{display:flex;gap:10px;align-items:center}label{color:var(--text-secondary);font-size:13px;font-weight:500;letter-spacing:0.01em}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}input[type="number"]{width:56px;background:#ffffff;border:1px solid var(--border);color:var(--text);padding:6px 8px;border-radius:8px;text-align:center;font-weight:600;font-size:14px;letter-spacing:0.01em;box-shadow:var(--shadow-sm);transition:border-color 0.2s ease,box-shadow 0.2s ease}input[type="number"]:hover{border-color:var(--border-strong)}input[type="number"]:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-light)}input[type="number"]::-webkit-outer-spin-button,input[type="number"]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type="number"]{-moz-appearance:textfield}.tile-type-row{gap:14px}.tile-type-label{display:inline-flex;flex-direction:column;align-items:center;gap:8px;position:relative}.tile-icon{width:48px;height:44px;display:block}.tile-icon polygon{stroke:rgba(55,47,36,0.35);stroke-width:1.6;stroke-linejoin:round}.tile-icon__outline{fill:none}.tile-icon__segments{display:block}.tile-icon__segment{stroke:none}.tile-icon__segments--mono .tile-icon__segment--mono{fill:#d46a6a}.tile-icon__segments--bi .tile-icon__segment--bi-major{fill:#d46a6a}.tile-icon__segments--bi .tile-icon__segment--bi-minor{fill:#b8b1a7}.tile-icon__segments--tri .tile-icon__segment--tri-a{fill:#d46a6a}.tile-icon__segments--tri .tile-icon__segment--tri-b{fill:#64b5f6}.tile-icon__segments--tri .tile-icon__segment--tri-c{fill:#81c784}.tile-type-label input{margin-top:2px}button{background:var(--accent);color:#fff;border:none;padding:10px 16px;border-radius:8px;cursor:pointer;font-weight:600;font-size:14px;letter-spacing:0.02em;box-shadow:var(--shadow-sm);transition:background-color 0.2s ease,transform 0.1s ease,box-shadow 0.2s ease}button:hover{background:var(--accent-hover);transform:translateY(-1px);box-shadow:var(--shadow-md)}button:active{transform:translateY(0)}#clear{background:#c94a43}#clear:hover{background:#b1332f}#clear:active{background:#9a2a26}.field--colors .row{flex-wrap:wrap;gap:12px}.color-percent{width:56px;font-weight:600}.players{display:flex;align-items:center;gap:14px}.player-row{display:flex;gap:16px;align-items:flex-end}.player-option{position:relative;display:inline-flex}.player-option input{position:absolute;opacity:0;pointer-events:none}.player-label{display:inline-flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer}.player-shape{display:inline-flex;align-items:center;justify-content:center;width:72px;height:72px;border-radius:16px;border:2px solid var(--border);background:#ffffff;box-shadow:var(--shadow-sm);transition:all 0.2s ease}.player-label:hover .player-shape{border-color:var(--accent);box-shadow:var(--shadow-md);transform:translateY(-2px)}.player-option input:checked+.player-label .player-shape{border-color:var(--accent);border-width:3px;background:var(--accent-light);box-shadow:var(--shadow-lg),0 0 0 4px var(--accent-light);transform:translateY(-3px)}.player-option input:focus-visible+.player-label .player-shape{outline:2px solid var(--accent);outline-offset:4px}.player-icon{width:52px;height:52px}.player-outline{fill:rgba(120,112,98,0.65);stroke:var(--overlay-gray);stroke-width:2}.player-icon image{pointer-events:none}.player-name{font-size:12px;font-weight:600;letter-spacing:0.04em;padding:4px 10px;border-radius:8px;color:var(--text-secondary);background:var(--panel);border:1px solid var(--border)}.player-option input:checked+.player-label .player-name{color:var(--accent);background:var(--accent-light);border-color:var(--accent);font-weight:700}.topbar{background:linear-gradient(180deg,#ffffff,var(--panel));border-bottom:1px solid var(--border);padding:16px 24px;display:flex;flex-wrap:wrap;align-items:center;gap:24px;box-shadow:var(--shadow-sm)}.topbar-controls{display:flex;flex-direction:column;align-items:stretch;gap:16px;min-width:260px}.topbar-controls .field{display:flex;flex-direction:column;gap:8px;width:100%}.topbar-controls .field>label{font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:0.05em;color:var(--text-secondary)}.topbar-controls .row{display:flex;gap:10px;flex-wrap:wrap;width:100%}.topbar-controls .row label:not(.color-field){display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:8px;background:var(--panel);border:1px solid var(--border);color:var(--text);font-weight:600;font-size:13px;letter-spacing:0.02em}.topbar-actions{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;margin:0 auto;text-align:center}.turn-indicator{font-weight:700;font-size:15px;letter-spacing:0.03em;color:var(--text);text-transform:uppercase}.action-buttons{display:flex;flex-direction:column;align-items:center;gap:10px;min-width:170px}.action-buttons button{width:170px;border-radius:10px;border:none;font-weight:600;letter-spacing:0.03em;padding:10px 12px;font-size:14px;color:#fff;box-shadow:var(--shadow-md);transition:all 0.2s ease}.action-buttons button:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}.action-buttons button:active{transform:translateY(0)}#end-turn{background:linear-gradient(135deg,#e89b3c,#d58b37)}#generate{background:linear-gradient(135deg,#3c5d87,#2a4b70)}#generate:hover{background:linear-gradient(135deg,#355276,#243f60)}#generate:active{background:linear-gradient(135deg,#2d4666,#1d324d)}#clear{background:linear-gradient(135deg,#d65a52,#c94a43)}main{flex:1 1 auto;display:flex;flex-wrap:wrap;gap:20px;padding:0 24px 24px;min-height:0}#board-container{flex:1 1 0%;display:flex;align-items:center;justify-content:center;padding:16px;min-height:0;min-width:0;height:clamp(320px,calc(100vh - 220px),720px)}#board-surface{flex:1;display:flex;align-items:center;justify-content:center;width:100%;height:100%;min-height:0;min-width:0}#palette{flex:0 0 140px;width:140px;border:1px solid var(--border);padding:16px 12px;display:flex;flex-direction:column;background:var(--panel);border-radius:16px;box-shadow:var(--shadow-sm);min-height:0;overflow-y:auto}#palette-items{display:flex;flex-direction:column;align-items:center;width:100%;padding-block:6px;gap:28px}#square-grid{pointer-events:none}#square-grid rect{fill:color-mix(in srgb,rgba(255,255,255,0.9)70%,var(--panel)30%);stroke:rgba(80,72,60,0.35);stroke-width:1.2}#square-market{pointer-events:auto}.market-slot{fill:color-mix(in srgb,var(--panel)60%,rgba(0,0,0,0.08)40%);stroke:rgba(62,50,44,0.2);stroke-width:1;pointer-events:auto}#square-values{pointer-events:none}.square-value{fill:var(--text-secondary);font-size:13px;font-weight:700;text-anchor:middle;dominant-baseline:central;opacity:0.85}.square-player-marker{pointer-events:none;transition:transform 0.2s ease,opacity 0.2s ease}.square-player-marker circle{opacity:0.88}.square-player-marker-label{fill:#ffffff;font-weight:700;letter-spacing:0.03em}.square-player-marker--active circle{opacity:1;stroke:var(--accent);stroke-width:2.2}#square-indicator{pointer-events:none}#square-indicator .square-indicator-circle{fill:var(--accent);stroke:#ffffff;stroke-width:2.4;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.25))}#square-indicator .square-indicator-crest{pointer-events:none}.colon-marker{pointer-events:auto;cursor:pointer;transition:transform 0.2s ease}.colon-marker-circle{opacity:0.85;transition:stroke-width 0.2s ease,opacity 0.2s ease}.colon-marker--active .colon-marker-circle{opacity:1;stroke-width:4px}.colon-marker--selected .colon-marker-circle{stroke:#1f1a12;stroke-width:5px}.palette-option{position:relative;display:inline-flex}.palette-option input{position:absolute;opacity:0;pointer-events:none}.palette-label{display:inline-flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer}.palette-shape{display:inline-flex;align-items:center;justify-content:center;width:90px;height:90px;border-radius:16px;border:1px solid var(--border);background:linear-gradient(150deg,rgba(255,255,255,0.96),var(--panel));box-shadow:inset 0 1px 0 rgba(255,255,255,0.7),var(--shadow-sm);transition:all 0.2s ease}.palette-label:hover .palette-shape{border-color:var(--accent);box-shadow:inset 0 1px 0 rgba(255,255,255,0.7),var(--shadow-md);transform:translateY(-2px)}.palette-option input:checked+.palette-label .palette-shape{border-color:var(--accent);background:linear-gradient(150deg,rgba(201,122,54,0.22),rgba(255,255,255,0.96));box-shadow:inset 0 1px 0 rgba(255,255,255,0.75),0 10px 24px rgba(0,0,0,0.16),0 0 0 3px var(--accent-light);transform:translateY(-2px)}.palette-option input:focus-visible+.palette-label .palette-shape{outline:2px solid var(--accent);outline-offset:4px}.palette-shape svg{width:78px;height:78px;display:block;pointer-events:none}.palette-name{font-size:11px;font-weight:600;letter-spacing:0.04em;padding:4px 8px;border-radius:8px;color:var(--text-secondary);background:var(--panel);border:1px solid var(--border)}.palette-option input:checked+.palette-label .palette-name{color:var(--accent);background:var(--accent-wash);border-color:var(--accent);font-weight:700}svg{width:100%;height:100%;max-width:100%;max-height:100%;background:transparent;border:1px solid var(--border);border-radius:10px}.tile{cursor:pointer}.tile:hover .outline{stroke:var(--text);stroke-width:1.8}.outline{fill:none;stroke:var(--outline);stroke-width:1.3}.hit-area{fill:transparent;stroke:none;pointer-events:fill}.stats-modal{position:fixed;top:120px;right:40px;width:280px;background:var(--bg);border:1px solid #bcae92;border-radius:6px;box-shadow:0 15px 35px rgba(0,0,0,0.25),0 5px 10px rgba(0,0,0,0.15);display:none;z-index:1500;user-select:none;color:var(--text);opacity:0;transform:scale(0.95)translateY(-10px);transition:opacity 0.2s ease,transform 0.2s ease}.stats-modal.visible{display:block;opacity:1;transform:scale(1)translateY(0)}.stats-modal-header{display:flex;align-items:center;justify-content:center;position:relative;padding:12px;cursor:move;border-bottom:1px solid #bcae92;background:linear-gradient(to bottom,var(--panel),#e1d8c2);border-top-left-radius:5px;border-top-right-radius:5px;font-weight:600;font-size:14px;letter-spacing:0.05em;text-shadow:0 1px 0 rgba(255,255,255,0.3)}.stats-modal-body{padding:16px}.stats-grid{display:grid;grid-template-columns:1fr auto;gap:10px 16px}.stats-grid div:last-child{font-weight:700;font-family:"SFMono-Regular",Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:right;min-width:40px}.stats-grid+.stats-section-title{margin-top:20px}.stats-section-title{font-weight:700;font-size:12px;text-transform:uppercase;letter-spacing:0.08em;margin-bottom:10px;border-bottom:1px solid #dcd1b9;padding-bottom:6px;color:var(--muted)}.stats-modal-close{position:absolute;top:50%;right:8px;transform:translateY(-50%);border:none;background:none;color:var(--muted);font-size:24px;font-weight:400;cursor:pointer;padding:4px 8px;line-height:1;border-radius:50%;transition:background-color 0.2s ease,color 0.2s ease}.stats-modal-close:hover{background-color:rgba(0,0,0,0.1);color:var(--text)}.scoreboard{margin-left:auto;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:18px;padding:6px 12px}.scorecard{display:inline-flex;flex-direction:column;align-items:center;gap:6px;padding:4px;background:transparent;border:none;cursor:pointer;color:var(--text);transition:transform 0.15s ease,color 0.15s ease}.scorecard:hover{transform:translateY(-2px)}.scorecard:focus-visible{outline:2px solid var(--accent);outline-offset:6px;border-radius:12px}.scorecard svg{width:64px;height:64px}.scorecard-shape{fill:#ffffff;stroke:rgba(60,52,42,0.35);stroke-width:2;transition:fill 0.2s ease,stroke 0.2s ease}.scorecard--active{color:var(--accent)}.scorecard--active .scorecard-shape{fill:var(--accent-light);stroke:var(--accent)}.scorecard-crest{mix-blend-mode:normal}.scorecard-score{font-family:"SFMono-Regular",Consolas,Menlo,monospace;font-size:16px;font-weight:600;letter-spacing:0.02em;margin-top:2px}.scorecard--active .scorecard-score{color:var(--accent)}.overlay{fill:none;stroke:var(--overlay-gray);stroke-width:2.5}.overlay.fill{fill:color-mix(in srgb,var(--overlay-gray)25%,transparent)}.overlay-solid{fill:var(--overlay-gray);stroke:none}.junction{fill:transparent;stroke:var(--overlay-gray);stroke-width:1.5;cursor:pointer}.junction.selected{fill:transparent;stroke-width:2}